<html>
	<head>
		<meta charset="utf-8">
		<script type="text/javascript" src="scripts/jquery-3.1.1.js"></script>
	</head>
	<body>
	    <H1>Hello, this is Company Agent!</H1>
		<div>
		    <div class="chatRecords">
			</div>
		    <input type="text" name="message" id="message" class="inputMessage">
		    <input type="button" name="sendMessage" id="sendMessage" value="Send Message" class="sendMessageBtn">
		</div>
		<!-- Start of LiveChat (www.livechatinc.com) code -->
		<script type="text/javascript">
		    var OPEN = 0, MSG = 1, CLOSE = 2, ERROR = 3;
			var ws = null;
			
			function getMsgStr(message) {
			    if (!message) {
				    return null;
				}
			    var msgData = JSON.parse(message);
				if (!msgData) {
				    return null;
				}
				var customerId = msgData.customerId;
				var type = msgData.type;
				var result = customerId + ": ";
				if (type == OPEN) return result + "connected";
				if (type == CLOSE) return result + "is offline";
				if (type == ERROR) return result + "encounters an error";
				return result + msgData.msg;
			}
			
		    function appendChatRecord(message) {
				if (message) {
			        $(".chatRecords").append("<div class='chatMessage'>" + message + "</div>");
				}
			}
			
			function startCommunication() {
				ws = new WebSocket("ws://localhost:8180/CompanyAgent/events?Company=Schlumberger"); 
				ws.onopen = function(){
				    sendMsg("server", "Company Agent ready!");
				}; 
				ws.onmessage = function(evt){
					console.log(evt.data);
					appendChatRecord(getMsgStr(evt.data));
				}; 
				ws.onclose = function(evt){console.log("WebSocketClosed!");}; 
				ws.onerror = function(evt){console.log("WebSocketError!");};
			}
			
			function Message(customerId, msg) {
				this.customerId = customerId;
				this.msg = msg;
			}
			
			function sendMsg(customerId, msg) {
				if (msg) {
				    ws.send(JSON.stringify(new Message(customerId, msg)));
				}
			}
			
			$(".sendMessageBtn").bind("click", function() {
			    var msg = $(".inputMessage")[0].value;
				if (msg) {
				    sendMsg("all", msg);
					appendChatRecord("Company Agent: " + msg);
					$(".inputMessage")[0].value = "";
				}
			});
			
			startCommunication();
		</script>
		<!-- End of LiveChat code -->
	</body>
</html>