<html>
	<head>
		<meta charset="utf-8">
		<script type="text/javascript" src="scripts/jquery-3.1.1.js"></script>
		<link rel="stylesheet" href="css/customerLiveChat.css">
	</head>
	<body>
	    <H1>Hello, this is Customer!</H1>

		
		
		<!-- Start of LiveChat Widget in Customer side -->
		<div id="liveChat-Widget">
			<div id="liveChat-minimized">
				<div id="lc-content">
				    <a id="lc-full-view-button" class="lc-widget-header" href="#">
						<span id="lc-open-label">Chat with Customer Service</span>
					</a>
				</div>
			</div>
			<div id="liveChat-full">
				<div id="lc-wrapper" class="lc-outline">
					<table class="lc-content" cellspacing="0" cellpadding="0"><tbody>
						<tr id="lc-title-container"><td>
							<a id="lc-title-row" class="lc-widget-header" href="#">
								<span id="lc-close-chat" class="lc-title-button" data-title="Close the chat">x</span>	
								<span id="lc-minimize" class="lc-title-button" data-title="Minimize window">-</span>		
								<span id="lc-title-text">Customer Service</span>
							</a>					
						</td></tr>
						<tr id="lc-chat-container"><td>
							<div id="lc-chatRecords"></div>
						</td></tr>
						<tr id="lc-chat-control"><td>
						    <div id="lc-startChat-container">
								<input type="button" name="startChat" id="lc-startChat" value="Start Chat" class="lc-startChatBtn">
							</div>
						    <div id="lc-sendMessage-container">
								<div><input type="text" name="message" id="lc-message" class="lc-inputMessage"></div>
								<div><input type="button" name="sendMessage" id="lc-sendMessage" value="Send Message" class="lc-sendMessageBtn"></div>
							</div>
						</td></tr>
					</tbody></table>
				</div>		
			</div>
		</div>
		
		<!-- End of LiveChat Widget in Customer side -->
		
		<!-- Start of LiveChat (www.livechatinc.com) code -->
		<script type="text/javascript">			
			var ws = null;
			
			function startCommunication() {
				if (ws) {
					return;
				}
				try {
					ws = new WebSocket("ws://localhost:8080/Customer/events?Company=Schlumberger"); 
				} catch (e) {
				    appendChatRecord(e);
				}
				
				ws.onopen = function(){
				    appendChatRecord("Connected to Customer Service.");
					toggleChatContoller(true);
				}; 
				ws.onmessage = function(evt){
					console.log(evt.data);
					appendChatRecord(evt.data);
				}; 
				ws.onclose = function(evt){
				    appendChatRecord("Communicating to Customer Service closed!");
					toggleChatContoller(false);
				    ws = null;
				}; 
				ws.onerror = function(evt){
				    appendChatRecord("Error in communicating with Customer Service!");
				};
			}
			
			function stopCommunication() {
				if (!ws) {
					return;
				}
				ws.close();
			}
			
		    function appendChatRecord(message) {
			    if (message) {
					$("#lc-chatRecords").append("<div class='lc-chatMessage'>" + message + "</div>");
				    $("#lc-chatRecords")[0].scrollTop = $("#lc-chatRecords")[0].scrollHeight;
				}
			}
			
			function toggleWidget(fullView, minimizedView) {
				var fullViewStyle = fullView ? "visible" : "hidden";
				var minimizedViewStyle = minimizedView ? "visible" : "hidden";
				$("#liveChat-minimized").css("visibility", minimizedViewStyle);
				$("#liveChat-full").css("visibility", fullViewStyle);
			}
			
			function toggleChatContoller(chatStarted) {
				var startChatStyle = chatStarted ? "hidden" : "visible";
				var sendMsgStyle = chatStarted ? "visible" : "hidden";
				$("#lc-startChat-container").css("visibility", startChatStyle);
				$("#lc-sendMessage-container").css("visibility", sendMsgStyle);
			}
			
			$("#lc-full-view-button").bind("click", function() {
				toggleWidget(true, false);
			});
			
			$("#lc-minimize").bind("click", function() {
				toggleWidget(false, true);
			});
			
			$("#lc-close-chat").bind("click", function() {
				stopCommunication();
				toggleWidget(false, false);
			});
			
			$(".lc-startChatBtn").bind("click", function() {
				startCommunication();
			});
			
			$(".lc-sendMessageBtn").bind("click", function() {
			    var msg = $(".lc-inputMessage")[0].value;
				if (msg) {
				    ws.send(msg);
					appendChatRecord("Me: " + msg);
					$(".lc-inputMessage")[0].value = "";
				}
			});
		</script>
		<!-- End of LiveChat code -->
	</body>
</html>